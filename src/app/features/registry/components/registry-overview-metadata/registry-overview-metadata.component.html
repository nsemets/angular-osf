@let resource = registry();

@if (resource && resource.id) {
  <div class="metadata flex flex-column gap-5">
    <div class="metadata-header flex align-items-center justify-content-between">
      <h2>{{ 'project.overview.metadata.title' | translate }}</h2>

      @if (canEdit()) {
        <p-button
          [routerLink]="'../metadata'"
          severity="secondary"
          [label]="'common.buttons.edit' | translate"
        ></p-button>
      }
    </div>

    <div class="flex flex-column gap-2">
      <h3>{{ 'common.labels.contributors' | translate }}</h3>

      <div class="flex flex-wrap gap-1 line-height-2">
        <osf-contributors-list
          [contributors]="bibliographicContributors()"
          [isLoading]="isBibliographicContributorsLoading()"
          [hasLoadMore]="hasMoreBibliographicContributors()"
          [anonymous]="!!isAnonymous()"
          (loadMoreContributors)="handleLoadMoreContributors()"
        ></osf-contributors-list>
      </div>
    </div>

    <div class="flex flex-column gap-2">
      <h3>{{ 'project.overview.metadata.description' | translate }}</h3>

      <osf-truncated-text
        [maxVisibleLines]="3"
        [text]="resource.description ? resource.description : ('project.overview.metadata.noDescription' | translate)"
      />
    </div>

    <div class="flex flex-column gap-2">
      <h3>{{ 'registry.overview.metadata.type' | translate }}</h3>
      <p>{{ resource.registrationSupplement }}</p>
    </div>

    @if (resource.associatedProjectId) {
      <div class="flex flex-column gap-2">
        <h3>{{ 'registry.overview.metadata.associatedProject' | translate }}</h3>

        <a class="font-bold" [routerLink]="['/', resource.associatedProjectId]">
          {{ webUrl + '/' + resource.associatedProjectId }}
        </a>
      </div>
    }

    <div class="flex gap-5 lg:gap-2 lg:justify-content-between">
      <div class="flex flex-column gap-2">
        <h3>{{ 'project.overview.metadata.dateCreated' | translate }}</h3>
        <p>{{ resource.dateCreated | date: dateFormat }}</p>
      </div>

      <div class="flex flex-column gap-2">
        <h3>{{ 'registry.overview.metadata.registeredDate' | translate }}</h3>
        <p>{{ resource.dateRegistered | date: dateFormat }}</p>
      </div>
    </div>

    <div class="flex flex-column gap-2">
      <h3>{{ 'common.labels.license' | translate }}</h3>

      <osf-resource-license [license]="license()" [isLoading]="isLicenseLoading()"></osf-resource-license>
    </div>

    @if (resource.iaUrl) {
      <div class="flex flex-column gap-2">
        <h3>{{ 'project.overview.metadata.internetArchiveLink' | translate }}</h3>

        <div>{{ resource.iaUrl }}</div>
      </div>
    }

    @if (!isAnonymous()) {
      <div class="flex flex-column gap-2">
        <h3>{{ 'registry.overview.metadata.doi' | translate }}</h3>

        <osf-resource-doi [identifiers]="identifiers()" [isLoading]="isIdentifiersLoading()"></osf-resource-doi>
      </div>
    }

    @if (!isAnonymous()) {
      <div class="flex flex-column gap-2">
        <h3>{{ 'common.labels.affiliatedInstitutions' | translate }}</h3>

        <osf-affiliated-institutions-view [institutions]="institutions() || []" [isLoading]="isInstitutionsLoading()" />
      </div>
    }

    <div class="flex flex-column gap-2">
      <h3>{{ 'common.labels.subjects' | translate }}</h3>

      <osf-subjects-list [subjects]="subjects()" [isLoading]="isSubjectsLoading()"></osf-subjects-list>
    </div>

    <div class="flex flex-column gap-2">
      <h3>{{ 'project.overview.metadata.tags' | translate }}</h3>

      <osf-tags-list [tags]="resource.tags" (tagClick)="tagClicked($event)"></osf-tags-list>
    </div>

    @if (!isAnonymous()) {
      <osf-resource-citations
        [resourceId]="registry()!.id"
        [resourceType]="currentResourceType"
        [customCitations]="registry()?.customCitation"
        [canEdit]="canEdit()"
        (customCitation)="onCustomCitationUpdated($event)"
      ></osf-resource-citations>
    }
  </div>
}
