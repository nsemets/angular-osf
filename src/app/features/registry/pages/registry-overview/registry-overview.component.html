@if (!isRegistryLoading()) {
  <div
    class="flex flex-column justify-content-center flex-wrap md:flex-row md:justify-content-between md:align-items-center"
  >
    <osf-sub-header
      [title]="registry()?.title ?? ''"
      [showButton]="canMakeDecision()"
      [buttonSeverity]="'success'"
      [buttonLabel]="'moderation.makeDecision.header' | translate"
      [isButtonDisabled]="!isRootRegistration()"
      [isSubmitting]="areReviewActionsLoading()"
      (buttonClick)="handleOpenMakeDecisionDialog()"
    />

    @if (showToolbar()) {
      <div class="pb-5 pl-4 ml-auto w-full md:pr-4">
        <osf-registration-overview-toolbar
          [resourceId]="registry()!.id"
          [resourceTitle]="registry()!.title"
          [isPublic]="!!registry()?.isPublic"
        />
      </div>
    }
  </div>

  @if (registry()?.archiving) {
    <div class="flex flex-column bg-white flex-1 p-4 gap-4">
      <osf-archiving-message [registration]="registry()!"></osf-archiving-message>
    </div>
  } @else if (registry()?.withdrawn) {
    <div class="flex flex-column bg-white flex-1 p-4 gap-4">
      <osf-withdrawn-message [registration]="registry()!"></osf-withdrawn-message>
    </div>
  } @else {
    <div class="flex flex-column bg-white flex-1 p-4 gap-4">
      @if (schemaResponse() && !schemaResponse()?.isOriginalResponse && !isInitialState) {
        <p-message class="overview-message w-full" severity="warn">
          <ng-template #container>
            <div>
              <h4 class="mb-1">
                {{ 'registry.overview.updatedRevisionDescription' | translate }}
                {{ schemaResponse()?.dateCreated | date }}.
              </h4>
              <p>
                {{ 'registry.overview.updateReason' | translate }}
              </p>
              <p>
                {{ schemaResponse()?.revisionJustification }}
              </p>
            </div>
          </ng-template>
        </p-message>
      }

      @if (hasViewOnly()) {
        <osf-view-only-link-message />
      }

      <osf-data-resources
        [absoluteUrl]="registry()?.id"
        [hasData]="registry()?.hasData"
        [hasAnalyticCode]="registry()?.hasAnalyticCode"
        [hasMaterials]="registry()?.hasMaterials"
        [hasPapers]="registry()?.hasPapers"
        [hasSupplements]="registry()?.hasSupplements"
      ></osf-data-resources>

      <div class="flex flex-column gap-4 xl:flex-row">
        <div class="left-section">
          @if (!isAnonymous()) {
            <div class="flex flex-column gap-4 md:flex-row resource">
              <osf-registry-statuses
                [registry]="registry()"
                [canEdit]="hasAdminAccess()"
                [isModeration]="isModeration"
              ></osf-registry-statuses>

              <osf-registry-revisions
                [registry]="registry()"
                [schemaResponses]="schemaResponses()"
                [selectedRevisionIndex]="selectedRevisionIndex()"
                (openRevision)="openRevision($event)"
                (updateRegistration)="onUpdateRegistration($event)"
                (continueUpdate)="onContinueUpdateRegistration()"
                [isModeration]="isModeration"
                [isSubmitting]="isSchemaResponsesLoading()"
                [canEdit]="hasAdminAccess()"
              >
              </osf-registry-revisions>
            </div>
          }

          <div class="blocks-section p-4">
            <osf-registry-blocks-section
              [schemaBlocks]="schemaBlocks()"
              [isLoading]="isSchemaBlocksLoading() || isSchemaResponsesLoading()"
              [schemaResponse]="schemaResponse()"
            ></osf-registry-blocks-section>
          </div>
        </div>

        <div class="flex flex-column right-section p-4">
          <osf-registry-overview-metadata />
        </div>
      </div>
    </div>
  }
} @else {
  <div class="flex-1">
    <osf-loading-spinner />
  </div>
}
