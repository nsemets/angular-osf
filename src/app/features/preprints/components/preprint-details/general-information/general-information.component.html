<p-card>
  @if (preprint()) {
    @let preprintValue = preprint()!;

    <div class="flex flex-column gap-4">
      <section class="flex flex-column gap-2">
        <h3>{{ 'preprints.preprintStepper.review.sections.metadata.authors' | translate }}</h3>

        <div class="flex flex-column gap-1 line-height-2 md:flex-row">
          <osf-contributors-list
            [contributors]="bibliographicContributors()"
            [isLoading]="areContributorsLoading()"
            [hasLoadMore]="hasMoreBibliographicContributors()"
            (loadMoreContributors)="handleLoadMoreContributors()"
          ></osf-contributors-list>
        </div>
      </section>

      <section class="flex flex-column gap-2">
        <h3>{{ 'preprints.preprintStepper.common.labels.abstract' | translate }}</h3>
        <osf-truncated-text [maxVisibleLines]="2" [text]="preprintValue.description" />
      </section>

      @if (affiliatedInstitutions().length) {
        <section class="flex flex-column gap-2">
          <h3>{{ 'common.labels.affiliatedInstitutions' | translate }}</h3>

          <osf-affiliated-institutions-view [institutions]="affiliatedInstitutions()" />
        </section>
      }

      @if (preprintProvider()?.assertionsEnabled) {
        <section class="flex flex-column gap-2">
          <h3>{{ 'preprints.preprintStepper.review.sections.authorAssertions.publicData' | translate }}</h3>

          @switch (preprintValue.hasDataLinks) {
            @case (ApplicabilityStatus.NotApplicable) {
              <p>{{ 'preprints.preprintStepper.review.sections.authorAssertions.noData' | translate }}</p>
            }
            @case (ApplicabilityStatus.Unavailable) {
              {{ preprintValue.whyNoData }}
            }
            @case (ApplicabilityStatus.Applicable) {
              @for (link of preprintValue.dataLinks; track $index) {
                <p>{{ link }}</p>
              }
            }
          }
        </section>

        <section class="flex flex-column gap-2">
          <h3>
            {{ 'preprints.preprintStepper.review.sections.authorAssertions.publicPreregistration' | translate }}
          </h3>

          @switch (preprintValue.hasPreregLinks) {
            @case (ApplicabilityStatus.NotApplicable) {
              <p>
                {{ 'preprints.preprintStepper.review.sections.authorAssertions.noPrereg' | translate }}
              </p>
            }
            @case (ApplicabilityStatus.Unavailable) {
              {{ preprintValue.whyNoPrereg }}
            }
            @case (ApplicabilityStatus.Applicable) {
              @switch (preprintValue.preregLinkInfo) {
                @case (PreregLinkInfo.Analysis) {
                  <p>
                    {{ 'preprints.preprintStepper.common.labels.preregTypes.analysis' | translate }}
                  </p>
                }
                @case (PreregLinkInfo.Designs) {
                  <p>
                    {{ 'preprints.preprintStepper.common.labels.preregTypes.designs' | translate }}
                  </p>
                }
                @case (PreregLinkInfo.Both) {
                  <p>
                    {{ 'preprints.preprintStepper.common.labels.preregTypes.both' | translate }}
                  </p>
                }
              }
              @for (link of preprintValue.preregLinks; track $index) {
                <p>
                  <a [href]="link">{{ link }}</a>
                </p>
              }
            }
          }
        </section>
      }

      @if (preprintValue.nodeId) {
        <section class="flex flex-column gap-2">
          <h3>{{ 'preprints.details.supplementalMaterials' | translate }}</h3>
          <a class="font-bold flex gap-1" [href]="nodeLink()">
            {{ nodeLink() }}
            <osf-icon iconClass="fa fa-external-link-alt" />
          </a>
        </section>
      }

      @if (preprintProvider()?.assertionsEnabled) {
        <section class="flex flex-column gap-2">
          <h3>{{ 'preprints.preprintStepper.review.sections.authorAssertions.conflictOfInterest' | translate }}</h3>

          @if (preprintValue.hasCoi) {
            {{ preprintValue.coiStatement }}
          } @else {
            <p>{{ 'preprints.preprintStepper.review.sections.authorAssertions.noCoi' | translate }}</p>
          }
        </section>
      }

      <osf-preprint-doi-section
        [preprintProvider]="preprintProvider()"
        (preprintVersionSelected)="preprintVersionSelected.emit($event)"
      />
    </div>
  }

  @if (isPreprintLoading()) {
    <div class="flex flex-column gap-4">
      @for (i of skeletonData; track $index) {
        <section class="flex flex-column gap-2">
          <p-skeleton height="1.3rem" />
          <p-skeleton height="5rem" />
        </section>
      }
    </div>
  }
</p-card>
